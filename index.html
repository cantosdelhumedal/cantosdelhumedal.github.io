<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cantos Del Humedal</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Calibri', sans-serif;
            background: linear-gradient(135deg, #2e4d2b 0%, #bedf89 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            background: rgba(70, 52, 42, 0.95);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(10px);
            max-width: 900px;
            width: 100%;
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
            font-size: 4.5em;
            background: linear-gradient(45deg, #ffb10a, #da8d00);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        h2 {
            color: #f3b137;
            margin-bottom: 30px;
            font-size: 2.5em;
            background: linear-gradient(45deg, #ffb10a, #da8d00);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        h3 {
            color: #ffffff;
            margin-bottom: 30px;
            font-size: 2em;
            background: linear-gradient(45deg, #ffb10a, #da8d00);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        p {
            color: #ebebeb;
            margin-bottom: 30px;
            font-size: 1.5em;
            background: linear-gradient(45deg, #ffb10a, #da8d00);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        li {
            color: #ebebeb;
            margin-bottom: 30px;
            font-size: 1.0em;
            background: linear-gradient(45deg, #ffb10a, #da8d00);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .progress-bar {
            background: #e0e0e0;
            height: 10px;
            border-radius: 5px;
            margin-bottom: 30px;
            overflow: hidden;
        }

        .progress-fill {
            background: linear-gradient(90deg, #ffb10a, #ffd270);
            height: 100%;
            width: 20%;
            transition: width 0.5s ease;
        }

        .qr-scanner-section {
            background: #fff;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            text-align: center;
            border-top: 4px solid #b7ea66;
        }

        .qr-scanner-section h3 {
            margin-bottom: 15px;
            color: #333;
        }

        #qr-reader {
            width: 100%;
            max-width: 400px;
            margin: 0 auto;
            border-radius: 10px;
            overflow: hidden;
            background: #000000;
        }

        .scanner-controls {
            margin: 20px 0;
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .scanner-btn {
            background: linear-gradient(45deg, #e6ba42, #d3b050);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s ease;
        }

        .scanner-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }

        .scanner-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .pages-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .page-card {
            background: #fff;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .page-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #eac766, #eac766);
        }

        .page-card.unlocked {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
        }

        .page-card.locked {
            opacity: 0.6;
        }

        .page-title {
            font-size: 1.4em;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .page-description {
            color: #666;
            margin-bottom: 15px;
            line-height: 1.6;
        }

        .qr-code-required {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 10px;
            margin-bottom: 15px;
            font-size: 0.9em;
            color: #856404;
        }

        .page-button {
            background: linear-gradient(45deg, #eac766, #eac766);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s ease;
            width: 100%;
        }

        .page-button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }

        .page-button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .lock-icon {
            font-size: 1.2em;
        }

        .unlock-icon {
            font-size: 1.2em;
            color: #4CAF50;
        }

        .page-content {
            display: none;
            margin-top: 30px;
            padding: 25px;
            background: #f8f9fa;
            border-radius: 15px;
            border-left: 4px solid #667eea;
        }

        .page-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .back-button {
            background: #6c757d;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            margin-bottom: 20px;
            transition: background 0.3s ease;
        }

        .back-button:hover {
            background: #5a6268;
        }

        .stats {
            text-align: center;
            color: #666;
            margin-top: 20px;
        }

        .qr-codes-display {
            background: #e3f2fd;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
        }

        .qr-codes-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .qr-code-item {
            text-align: center;
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .qr-code-item canvas {
            margin-bottom: 10px;
        }

        .qr-code-item .qr-label {
            font-size: 0.9em;
            font-weight: bold;
            color: #333;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #28a745;
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            opacity: 0;
            transform: translateX(100%);
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .notification.show {
            opacity: 1;
            transform: translateX(0);
        }

        .notification.error {
            background: #dc3545;
        }

        .scanner-status {
            margin: 10px 0;
            padding: 10px;
            border-radius: 8px;
            font-weight: bold;
        }

        .scanner-status.waiting {
            background: #fff3cd;
            color: #856404;
        }

        .scanner-status.scanning {
            background: #d1ecf1;
            color: #0c5460;
        }

        .scanner-status.success {
            background: #d4edda;
            color: #155724;
        }

        .scanner-status.error {
            background: #f8d7da;
            color: #721c24;
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }
            
            .pages-grid {
                grid-template-columns: 1fr;
            }
            
            .qr-codes-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Cantos del Humedal</h1>
        <img src="img/mj_id.png" style="width:25%;">
        
        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>

        <div id="mainView">
            <!-- Scanner QR -->
            <div class="qr-scanner-section">
                <h3>üì∑ Esc√°ner de C√≥digos</h3>
                <div id="qr-reader"></div>
                <div id="scanner-status" class="scanner-status waiting">
                    Presiona "Iniciar Esc√°ner" para escanear los c√≥digos
                </div>
                <div class="scanner-controls">
                    <button class="scanner-btn" id="start-scanner" onclick="startQRScanner()">
                        Iniciar Esc√°ner
                    </button>
                    <button class="scanner-btn" id="stop-scanner" onclick="stopQRScanner()" disabled>
                        Detener Esc√°ner
                    </button>
                    <button class="scanner-btn" onclick="toggleQRCodes()">
                        Ver C√≥digos QR
                    </button>
                </div>
            </div>

            <!-- C√≥digos QR para escanear -->
            <div class="qr-codes-display" id="qr-codes-display" style="display: none;">
                <h3>üîç C√≥digos QR para Desbloquear P√°ginas</h3>
                <p style="color: #666; margin-bottom: 15px;">
                    Escanea estos c√≥digos QR con el esc√°ner de arriba para desbloquear las p√°ginas correspondientes:
                </p>
                <div class="qr-codes-grid" id="qr-codes-grid">
                    <!-- Los c√≥digos QR se generar√°n aqu√≠ -->
                </div>
            </div>

            <!-- Grid de p√°ginas -->
            <div class="pages-grid" id="pagesGrid">
                <!-- Las p√°ginas se generar√°n din√°micamente -->
            </div>

            <div class="stats">
                <p>P√°ginas desbloqueadas: <span id="unlockedCount">1</span> de <span id="totalCount">5</span></p>
            </div>
        </div>

        <div id="pageView" style="display: none;">
            <button class="back-button" onclick="showMainView()">‚Üê Volver al men√∫</button>
            <div id="pageContent"></div>
        </div>
    </div>

    <!-- Notificaci√≥n -->
    <div id="notification" class="notification"></div>

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html5-qrcode/2.3.8/html5-qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js"></script>

    <script>
        // Configuraci√≥n de p√°ginas con c√≥digos QR √∫nicos
        const pages = [
            {
                id: 1,
                title: "P√°gina de Ayuda",
                description: "Si necesitas ayuda con algo, puedes consultar aqu√≠.",
                unlocked: true,
                qrCode: "Ayuda",
                content: `
                    <h2>¬°Bienvenid@ a la secci√≥n de ayuda!</h2>

                    <p>En Cantos del Humedal, la meta es conocer m√°s sobre las aves que viven en el humedal La Conejera</p>
                    <p>Durante tu visita al humedal, puedes buscar c√≥digos escondidos en los miradores.</p>
                    <ul>
                        <li>Escanea los c√≥digos escondidos</li>
                        <li>Desbloquea la informaci√≥n de las aves y aprende m√°s sobre ellas</li>
                        <li>¬°Divi√©rtete buscando todos los c√≥digos que puedas!</li>
                    </ul>
                    <p><strong>üéØ Tu misi√≥n:</strong> Escanea todos los c√≥digos escondidos en el humedal y compite por un premio especial.</p>
                `
            },
            {
                id: 2,
                title: "Tingua Azul",
                description: "Un ave con un plumaje hermoso.",
                unlocked: false,
                qrCode: "tingua_azul",
                content: `
                    <h2>üê¶ Tinguas Azules</h2>
                    <p>¬°Genial! Has descubierto informaci√≥n sobre las tinguas azules escaneando el c√≥digo QR.</p>
                    <div style="background: #e3f2fd; padding: 20px; border-radius: 10px; margin: 20px 0;">
                        <h3>Informaci√≥n General</h3>
                        <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/f/fd/Purple_Gallinule_-_Georgia_-_USA_S4E9714_%2822787368534%29.jpg/640px-Purple_Gallinule_-_Georgia_-_USA_S4E9714_%2822787368534%29.jpg" 
                            alt="Tingua azul" 
                            style="width: 100%; max-width: 400px; border-radius: 10px; margin-bottom: 15px;">
                        
                        <p><strong>Nombre com√∫n:</strong> Tingua azul</p>
                        <p><strong>Nombre cient√≠fico:</strong> <em>Porphyrio martinicus</em></p>
                        <p><strong>H√°bitat:</strong> Vive en humedales, lagunas, pantanos y cuerpos de agua dulce con vegetaci√≥n densa.</p>
                        <p><strong>Distribuci√≥n:</strong> Se encuentra en gran parte de Am√©rica, desde el sur de Estados Unidos hasta Sudam√©rica, incluyendo Colombia.</p>
                        <p><strong>Caracter√≠sticas:</strong> Tiene plumaje azul y verde iridiscente, un pico rojo con punta amarilla y patas largas de color amarillo brillante. Es un ave muy llamativa.</p>
                        <p><strong>Estado de conservaci√≥n:</strong> <span style="color: green;">Preocupaci√≥n menor</span> ‚úÖ</p>
                    </div>

                `
            },
            {
                id: 3,
                title: "Monjita Bogotana",
                description: "Un ave con nombre curioso pero acertado.",
                unlocked: false,
                qrCode: "monjita_bogotana",
                content: `
                    <h2>üê§ Monjita Bogotana</h2>
                    <p>¬°Interesante! Has descubierto informaci√≥n sobre la monjita bogotana escaneando el c√≥digo QR.</p>
                    <div style="background: #e8f5e9; padding: 20px; border-radius: 10px; margin: 20px 0;">
                        <h3>Informaci√≥n General</h3>
                        <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/2/26/Bogota_Flowerpiercer_-_Male.jpg/640px-Bogota_Flowerpiercer_-_Male.jpg" 
                            alt="Monjita bogotana" 
                            style="width: 100%; max-width: 400px; border-radius: 10px; margin-bottom: 15px;">
                        
                        <p><strong>Nombre com√∫n:</strong> Monjita bogotana</p>
                        <p><strong>Nombre cient√≠fico:</strong> <em>Doliornis remseni</em></p>
                        <p><strong>H√°bitat:</strong> Se cree que habita bosques andinos y zonas de matorral altoandino en la cordillera Oriental de Colombia.</p>
                        <p><strong>Distribuci√≥n:</strong> End√©mica de Colombia, conocida por registros hist√≥ricos en la sabana de Bogot√°.</p>
                        <p><strong>Caracter√≠sticas:</strong> Ave peque√±a de plumaje oscuro, poco conocida por la ciencia debido a su rareza y falta de observaciones recientes.</p>
                        <p><strong>Estado de conservaci√≥n:</strong> <span style="color: red;">Cr√≠ticamente amenazada</span> ‚ùó</p>
                    </div>
                `
            },
            {
                id: 4,
                title: "Tangara de antifaz",
                description: "Un ave con talento para el disfraz.",
                unlocked: false,
                qrCode: "CONFIG-SETTINGS-2024",
                content: `
                    <h2>üê¶ T√°ngara de Antifaz</h2>
                    <p>¬°Excelente! Has accedido a informaci√≥n sobre la t√°ngara de antifaz escaneando el c√≥digo QR.</p>
                    <div style="background: #fff3e0; padding: 20px; border-radius: 10px; margin: 20px 0;">
                        <h3>Informaci√≥n General</h3>
                        <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/6/6d/Tangara_larvata_-_Costa_Rica_S4E8521_%2822070065813%29.jpg/640px-Tangara_larvata_-_Costa_Rica_S4E8521_%2822070065813%29.jpg" 
                            alt="T√°ngara de antifaz" 
                            style="width: 100%; max-width: 400px; border-radius: 10px; margin-bottom: 15px;">
                        
                        <p><strong>Nombre com√∫n:</strong> T√°ngara de antifaz</p>
                        <p><strong>Nombre cient√≠fico:</strong> <em>Tangara larvata</em></p>
                        <p><strong>H√°bitat:</strong> Bosques h√∫medos tropicales y subtropicales, bordes de selvas y zonas arboladas.</p>
                        <p><strong>Distribuci√≥n:</strong> Se encuentra desde el sur de M√©xico hasta el noroeste de Sudam√©rica, incluyendo Colombia.</p>
                        <p><strong>Caracter√≠sticas:</strong> De plumaje brillante con tonos azules y verdes, y un distintivo antifaz negro alrededor de los ojos que le da su nombre com√∫n.</p>
                        <p><strong>Estado de conservaci√≥n:</strong> <span style="color: green;">Preocupaci√≥n menor</span> ‚úÖ</p>
                    </div>
                `
            },
            {
                id: 5,
                title: "P√°gina Secreta",
                description: "Descubre m√°s sobre de Cantos del Humedal.",
                unlocked: false,
                qrCode: "SECRET-MASTER-QR-2024",
                content: `
                    <h2>üèÜ ¬°P√°gina Secreta QR Desbloqueada!</h2>
                    <div style="background: linear-gradient(45deg, #ffd700, #ffed4e); padding: 25px; border-radius: 15px; margin: 20px 0; text-align: center;">
                        <h3>¬°FELICIDADES!</h3>
                        <p style="font-size: 1.2em; margin: 15px 0;">Has escaneado todos los c√≥digos disponibles.</p>
                        <p>¬°Eres oficialmente expert@ en las aves del humedal! <strong></strong>.</p>
                    </div>
                    <div style="background: #e1f5fe; padding: 20px; border-radius: 10px;">
                        <h4>üîì Acceso Exclusivo:</h4>
                        <p>Como expert@ tienes acceso a</p>
                        <ul>
                            <li>¬°Un prototipo para ver una monjita bogotana en 3D!</li>
                            <li><a href="https://asblr.com/k8lZ0p">¬°Toca aqu√≠ para ver a una monjita bogotana!</a><li>
                        </ul>
                    </div>
                    <div style="text-align: center; margin: 20px 0;">
                        <p style="font-style: italic; color: #666;">
                            "Recuerda, las aves son los cantos de la naturaleza. Si protegemos su vuelo, protegemos nuestro mundo."
                        </p>
                    </div>
                `
            }
        ];

        // Estado del sistema
        let systemState = {
            unlockedPages: [1],
            currentPage: null,
            scannedCodes: ['INICIO-2024'],
            sessionStartTime: Date.now(),
            qrScanner: null,
            scannerRunning: false
        };

        // Inicializar la aplicaci√≥n
        function initApp() {
            renderPages();
            generateQRCodes();
            updateProgress();
            updateStats();
            startSessionTimer();
        }

        // Generar c√≥digos QR para mostrar
        function generateQRCodes() {
            const grid = document.getElementById('qr-codes-grid');
            grid.innerHTML = '';

            pages.forEach(page => {
                if (page.id === 1) return; // Skip inicio ya que est√° desbloqueado

                const qrItem = document.createElement('div');
                qrItem.className = 'qr-code-item';
                
                const canvas = document.createElement('canvas');
                const qr = new QRious({
                    element: canvas,
                    value: page.qrCode,
                    size: 120,
                    background: 'white',
                    foreground: '#333'
                });

                const label = document.createElement('div');
                label.className = 'qr-label';
                label.textContent = page.title;

                qrItem.appendChild(canvas);
                qrItem.appendChild(label);
                grid.appendChild(qrItem);
            });
        }

        // Iniciar esc√°ner QR
        function startQRScanner() {
            if (systemState.scannerRunning) return;

            const config = {
                fps: 10,
                qrbox: { width: 250, height: 250 },
                aspectRatio: 1.0
            };

            systemState.qrScanner = new Html5Qrcode("qr-reader");
            
            systemState.qrScanner.start(
                { facingMode: "environment" },
                config,
                onScanSuccess,
                onScanError
            ).then(() => {
                systemState.scannerRunning = true;
                document.getElementById('start-scanner').disabled = true;
                document.getElementById('stop-scanner').disabled = false;
                updateScannerStatus('scanning', 'üì∑ Escaneando... Apunta la c√°mara al c√≥digo QR');
            }).catch(err => {
                updateScannerStatus('error', '‚ùå Error al acceder a la c√°mara: ' + err);
            });
        }

        // Detener esc√°ner QR
        function stopQRScanner() {
            if (!systemState.scannerRunning || !systemState.qrScanner) return;

            systemState.qrScanner.stop().then(() => {
                systemState.scannerRunning = false;
                document.getElementById('start-scanner').disabled = false;
                document.getElementById('stop-scanner').disabled = true;
                updateScannerStatus('waiting', 'Esc√°ner detenido. Presiona "Iniciar Esc√°ner" para continuar');
            }).catch(err => {
                console.error('Error stopping scanner:', err);
            });
        }

        // Manejar √©xito del escaneo
        function onScanSuccess(qrCodeMessage) {
            const page = pages.find(p => p.qrCode === qrCodeMessage);
            
            if (page && !systemState.unlockedPages.includes(page.id)) {
                // C√≥digo QR v√°lido y p√°gina no desbloqueada
                systemState.unlockedPages.push(page.id);
                systemState.scannedCodes.push(qrCodeMessage);
                
                updateProgress();
                updateStats();
                renderPages();
                
                updateScannerStatus('success', `‚úÖ ¬°P√°gina "${page.title}" desbloqueada!`);
                showNotification(`üéâ ¬°Nueva Ave desbloqueada!\n"${page.title}"`, 'success');
                
                // Detener esc√°ner temporalmente
                setTimeout(() => {
                    if (systemState.scannerRunning) {
                        updateScannerStatus('scanning', 'üì∑ Escaneando... Busca el siguiente c√≥digo');
                    }
                }, 2000);
                
            } else if (page && systemState.unlockedPages.includes(page.id)) {
                // C√≥digo ya utilizado
                updateScannerStatus('waiting', '‚ö†Ô∏è Esta ave ya est√° desbloqueada');
            } else {
                // C√≥digo QR no reconocido
                updateScannerStatus('error', '‚ùå C√≥digo QR no reconocido');
            }
        }

        // Manejar errores del escaneo
        function onScanError(errorMessage) {
            // Silenciar errores normales de escaneo
        }

        // Actualizar estado del esc√°ner
        function updateScannerStatus(type, message) {
            const status = document.getElementById('scanner-status');
            status.className = `scanner-status ${type}`;
            status.textContent = message;
        }

        // Mostrar/ocultar c√≥digos QR
        function toggleQRCodes() {
            const display = document.getElementById('qr-codes-display');
            display.style.display = display.style.display === 'none' ? 'block' : 'none';
        }

        // Renderizar las p√°ginas en la grilla
        function renderPages() {
            const grid = document.getElementById('pagesGrid');
            grid.innerHTML = '';

            pages.forEach(page => {
                const isUnlocked = systemState.unlockedPages.includes(page.id);
                
                const pageCard = document.createElement('div');
                pageCard.className = `page-card ${isUnlocked ? 'unlocked' : 'locked'}`;
                
                pageCard.innerHTML = `
                    <div class="page-title">
                        ${isUnlocked ? '<span class="unlock-icon">üîì</span>' : '<span class="lock-icon">üîí</span>'}
                        ${page.title}
                    </div>
                    <div class="page-description">${page.description}</div>
                    ${!isUnlocked ? `
                        <div class="qr-code-required">
                            üì± Requiere c√≥digo QR: <strong>${page.qrCode}</strong>
                        </div>
                    ` : ''}
                    <button class="page-button" ${!isUnlocked ? 'disabled' : ''} 
                            onclick="${isUnlocked ? `showPage(${page.id})` : ''}">
                        ${isUnlocked ? 'Acceder' : 'Escanear QR para Desbloquear'}
                    </button>
                `;

                grid.appendChild(pageCard);
            });
        }

        // Mostrar una p√°gina espec√≠fica
        function showPage(pageId) {
            const page = pages.find(p => p.id === pageId);
            if (!page || !systemState.unlockedPages.includes(pageId)) return;

            document.getElementById('mainView').style.display = 'none';
            document.getElementById('pageView').style.display = 'block';
            document.getElementById('pageContent').innerHTML = page.content;

            // Actualizar contador en el perfil
            if (pageId === 2) {
                const profileElement = document.getElementById('profileUnlocked');
                if (profileElement) {
                    profileElement.textContent = systemState.unlockedPages.length;
                }
            }

            // Generar certificado QR para la p√°gina secreta
            if (pageId === 5) {
                setTimeout(() => {
                    const canvas = document.getElementById('master-certificate-qr');
                    if (canvas) {
                        new QRious({
                            element: canvas,
                            value: `QR-MASTER-CERTIFICATE-${Date.now()}`,
                            size: 150,
                            background: 'white',
                            foreground: '#ffd700'
                        });
                    }
                }, 100);
            }

            // Actualizar estad√≠sticas del dashboard
            if (pageId === 3) {
                setTimeout(() => {
                    const qrCount = document.getElementById('qr-scanned-count');
                    const progress = document.getElementById('progress-percentage');
                    if (qrCount) qrCount.textContent = systemState.scannedCodes.length;
                    if (progress) progress.textContent = Math.round((systemState.unlockedPages.length / pages.length) * 100) + '%';
                }, 100);
            }
        }

        // Volver a la vista principal
        function showMainView() {
            document.getElementById('mainView').style.display = 'block';
            document.getElementById('pageView').style.display = 'none';
        }

        // Actualizar barra de progreso
        function updateProgress() {
            const progress = (systemState.unlockedPages.length / pages.length) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
        }

        // Actualizar estad√≠sticas
        function updateStats() {
            document.getElementById('unlockedCount').textContent = systemState.unlockedPages.length;
            document.getElementById('totalCount').textContent = pages.length;
        }

        // Mostrar notificaci√≥n
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type} show`;
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 4000);
        }

        // Timer de sesi√≥n
        function startSessionTimer() {
            setInterval(() => {
                const elapsed = Date.now() - systemState.sessionStartTime;
                const minutes = Math.floor(elapsed / 60000);
                const seconds = Math.floor((elapsed % 60000) / 1000);
                const timeElement = document.getElementById('session-time');
                if (timeElement) {
                    timeElement.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                }
            }, 1000);
        }

        // Limpiar recursos al salir
        window.addEventListener('beforeunload', () => {
            if (systemState.qrScanner && systemState.scannerRunning) {
                systemState.qrScanner.stop();
            }
        });

        // Inicializar la aplicaci√≥n cuando se carga la p√°gina
        window.onload = initApp;
    </script>
</body>
</html>